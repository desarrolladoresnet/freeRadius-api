<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>freerad-api documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">freerad-api documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >ServicesService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/services/services.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#CreateService" >CreateService</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#FindAllServices" >FindAllServices</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#FindOneOnSys" >FindOneOnSys</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#FindOnService" >FindOnService</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#RemoveService" >RemoveService</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#SyncService" >SyncService</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#UpdateService" >UpdateService</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(servicesRepository: <a href="../entitys/Service.html" target="_self">Repository&lt;Service&gt;</a>, userinfoRepository: <a href="../entitys/UserInfo.html" target="_self">Repository&lt;UserInfo&gt;</a>, radUserGroupRepository: <a href="../entitys/RadUserGroup.html" target="_self">Repository&lt;RadUserGroup&gt;</a>, nodesRepository: <a href="../entitys/ZonaCliente.html" target="_self">Repository&lt;ZonaCliente&gt;</a>, systemsRepository: <a href="../entitys/System.html" target="_self">Repository&lt;System&gt;</a>, plansRepository: <a href="../entitys/Plan.html" target="_self">Repository&lt;Plan&gt;</a>, sysServices: <a href="../injectables/SystemsService.html" target="_self">SystemsService</a>, coaServices: <a href="../injectables/CoaService.html" target="_self">CoaService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="18" class="link-to-prism">src/services/services.service.ts:18</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>servicesRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/Service.html" target="_self" >Repository&lt;Service&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>userinfoRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/UserInfo.html" target="_self" >Repository&lt;UserInfo&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>radUserGroupRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/RadUserGroup.html" target="_self" >Repository&lt;RadUserGroup&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>nodesRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/ZonaCliente.html" target="_self" >Repository&lt;ZonaCliente&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>systemsRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/System.html" target="_self" >Repository&lt;System&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>plansRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/Plan.html" target="_self" >Repository&lt;Plan&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>sysServices</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/SystemsService.html" target="_self" >SystemsService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>coaServices</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/CoaService.html" target="_self" >CoaService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="CreateService"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>CreateService</b></span>
                        <a href="#CreateService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>CreateService(service: <a href="../entitys/Service.html" target="_self">Service</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="47"
                            class="link-to-prism">src/services/services.service.ts:47</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Crea una nueva entrada en la tabla, el id de Radius es opcional dado que es probable que exista en Wisphub pero no en Radius en un primer momento.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../entitys/Service.html" target="_self" >Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="FindAllServices"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>FindAllServices</b></span>
                        <a href="#FindAllServices"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>FindAllServices()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="104"
                            class="link-to-prism">src/services/services.service.ts:104</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Trae toda las entradas en la tabla services.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="FindOneOnSys"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>FindOneOnSys</b></span>
                        <a href="#FindOneOnSys"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>FindOneOnSys(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="178"
                            class="link-to-prism">src/services/services.service.ts:178</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Buca el cliente  por id y se trae informacion del cliente en Wisphub.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;any | null&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="FindOnService"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>FindOnService</b></span>
                        <a href="#FindOnService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>FindOnService(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="140"
                            class="link-to-prism">src/services/services.service.ts:140</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Encuentra una entrada en services mediante el id</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="RemoveService"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>RemoveService</b></span>
                        <a href="#RemoveService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>RemoveService(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="356"
                            class="link-to-prism">src/services/services.service.ts:356</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Elimina una entrada en service mendiante el id.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="SyncService"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>SyncService</b></span>
                        <a href="#SyncService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>SyncService(node: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="223"
                            class="link-to-prism">src/services/services.service.ts:223</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Revisa la tabla de nodos para ver en que sistema se encuentra un nodo.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>node</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="UpdateService"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>UpdateService</b></span>
                        <a href="#UpdateService"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>UpdateService(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, updateServDto: <a href="../classes/UpdateServiceDto.html" target="_self">UpdateServiceDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="306"
                            class="link-to-prism">src/services/services.service.ts:306</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Realiza update de una entrada mediante el id.
Si no hay valores para realizar el update se rechaza la peticion.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>updateServDto</td>
                                    <td>
                                                <code><a href="../classes/UpdateServiceDto.html" target="_self" >UpdateServiceDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { Injectable, HttpStatus, HttpException } from &#x27;@nestjs/common&#x27;;
import { InjectRepository } from &#x27;@nestjs/typeorm&#x27;;
import { Repository } from &#x27;typeorm&#x27;;
import { UpdateServiceDto } from &#x27;src/dto/update-service.dto&#x27;;
import { CoaService } from &#x27;src/coa/coa.service&#x27;;
import { SystemsService } from &#x27;src/systems/systems.service&#x27;;
// import { CreateServiceDto } from &#x27;../dto/create-service.dto&#x27;;
//* EMTIDADES *//
import { Service } from &#x27;../database/service.entity&#x27;;
import { ZonaCliente } from &#x27;src/database/node.entity&#x27;;
import { System } from &#x27;src/database/system.entity&#x27;;
import { RadUserGroup } from &#x27;src/database/radusergroup.entity&#x27;;
import { UserInfo } from &#x27;src/database/user.entity&#x27;;
import { Plan } from &#x27;src/database/plan.entity&#x27;;

@Injectable()
export class ServicesService {
  constructor(
    @InjectRepository(Service)
    private servicesRepository: Repository&lt;Service&gt;,
    @InjectRepository(UserInfo)
    private userinfoRepository: Repository&lt;UserInfo&gt;,
    @InjectRepository(RadUserGroup)
    private radUserGroupRepository: Repository&lt;RadUserGroup&gt;,
    @InjectRepository(ZonaCliente)
    private nodesRepository: Repository&lt;ZonaCliente&gt;,
    @InjectRepository(System)
    private systemsRepository: Repository&lt;System&gt;,
    @InjectRepository(Plan)
    private plansRepository: Repository&lt;Plan&gt;,
    private sysServices: SystemsService,
    private coaServices: CoaService,
  ) {}

  //private readonly services: Service[] &#x3D; [];

  //////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Crea una nueva entrada en la tabla, el id de Radius es opcional dado que es probable que exista en Wisphub pero no en Radius en un primer momento.
   * @param service { Service }
   * @returns { object }
   */
  async CreateService(service: Service) {
    const { sys, clientId, radiusId, plan, status } &#x3D; service;

    try {
      //* Creando tabla *//
      const date &#x3D; new Date();
      console.log(
        &#x60;Creado nueva entrada en la tabla &#x27;service&#x27; con los valores: sys: ${sys}, clientId: ${clientId}, radiusId: ${radiusId} y plan: ${plan}.\nFecha: ${date}\n&#x60;,
      );
      const serviceNew &#x3D; this.servicesRepository.create({
        sys,
        clientId,
        radiusId,
        plan,
        status: status ? status : 1,
      });

      //* Salvando tabla y verificación *//
      const serviceSave &#x3D; await this.servicesRepository.save(serviceNew);
      if (!serviceSave) {
        const str &#x3D; &#x60;Hubo un problema para guardar el servicio&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );

        const err &#x3D; new Error(str);
        throw new HttpException(
          {
            status: HttpStatus.INTERNAL_SERVER_ERROR,
            error: str,
          },
          HttpStatus.INTERNAL_SERVER_ERROR,
          {
            cause: err,
          },
        );
      }

      console.log(
        &#x60;Servicio creado exitosamente.\n------------------------------------------------\n&#x60;,
      );
      return serviceSave;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Trae toda las entradas en la tabla services.
   * @returns { Array }
   */
  async FindAllServices() {
    try {
      const date &#x3D; new Date();
      console.log(&#x60;Buscando entradas en &#x27;services.\nFecha: ${date}\n&#x60;)
      const services &#x3D; await this.servicesRepository.find({
        relations: [&#x27;sys&#x27;, &#x27;plan&#x27;],
      });

      if (services.length &lt; 1) {
        const str &#x3D; &#x60;No se encontraron servicios.&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );
        return str;
      }

      console.log(
        &#x60;Se encontraron ${services?.length} servicios.\n------------------------------------------------\n&#x60;,
      );
      return services;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Encuentra una entrada en services mediante el id
   * @param id { number }
   * @returns { object }
   */
  async FindOnService(id: number) {
    //console.log((await this.servicesRepository.findOne({where:{ id }, relations:[&#x27;sys&#x27;,&#x27;plan&#x27;]})).plan[&#x27;id&#x27;])
    try {
      const date &#x3D; new Date();
      console.log(&#x60;Buscando entradas en &#x27;services&#x27; con el id: ${id}.\nFecha: ${date}\n&#x60;)
      const services &#x3D; await this.servicesRepository.findOne({
        where: { id },
        relations: [&#x27;sys&#x27;, &#x27;plan&#x27;],
      });

      if (!services) {
        const str &#x3D; &#x60;No se encontró un servicio con el id: ${id}.&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );
        return str;
      }

      console.log(
        &#x60;Servicio encontrado.\n------------------------------------------------\n&#x60;,
      );
      return services;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Buca el cliente  por id y se trae informacion del cliente en Wisphub.
   * @param id
   * @returns
   */
  async FindOneOnSys(id: number): Promise&lt;any | null&gt; {
    try {
      const date &#x3D; new Date();
      console.log(&#x60;Buscando información en service de la entrada ${id}.\nFecha: ${date}\n&#x60;);
      const serv &#x3D; await this.servicesRepository.findOne({
        where: { id },
        relations: [&#x27;sys&#x27;, &#x27;plan&#x27;],
      });
      const sys &#x3D; serv.sys;
      const ep &#x3D; sys[&#x27;endPoint&#x27;];
      // eslint-disable-next-line @typescript-eslint/no-var-requires
      const superagent &#x3D; require(&#x27;superagent&#x27;);
      const find &#x3D; await superagent
        .get(&#x60;${ep}${serv.clientId}&#x60;)
        .set(&#x27;authorization&#x27;, &#x60;Api-Key ${sys[&#x27;apiKey&#x27;]}&#x60;)
        .set(&#x27;content-type&#x27;, &#x27;application/json&#x27;)
        .then((res) &#x3D;&gt; res.body);

      if (!find) {
        const str &#x3D; &#x60;No se encontro información relativa al servicio con el id: ${id}.&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );
      }

      console.log(
        &#x60;Servicio encontrado.\n------------------------------------------------\n&#x60;,
      );
      return find;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Revisa la tabla de nodos para ver en que sistema se encuentra un nodo.
   * @param node
   * @returns
   */
  async SyncService(node: string) {
    const date &#x3D; new Date();
    console.log(&#x60;Buscando nodo ${node}}.\nFecha: ${date}\n&#x60;);
    try {
      const nodeSys &#x3D; await this.nodesRepository.findOne({where:{name:node}, relations:[&#x27;systems&#x27;]})
    const sys &#x3D; nodeSys[&#x27;systems&#x27;]
    const userinfoNodes &#x3D; await this.userinfoRepository.find({where:{address:node}})
    //Si existen clientes en la tabla userinfo
    if (userinfoNodes.length &gt; 0){
      // Por cada sistema que aloje el nodo ${node}
      sys.forEach(async i &#x3D;&gt; {
        const sysOnNode &#x3D; await this.sysServices.SysNode(i.id,node)
        // Para cada uno de los clientes de userinfo
        userinfoNodes.forEach(async o &#x3D;&gt; {
          if (await this.radUserGroupRepository.find({where:{username:o.username,priority:0}})){
          }
          // Siempre que hayan grupos asociados con cada cliente
          if (await this.radUserGroupRepository.find({where:{username:o.username}})){
            // Encontrar en la lista de servicios el correspondiente al radiusId &#x3D;&#x3D; userinfo.id
            if (await this.servicesRepository.findOne({where:{radiusId:o.id},relations:[&#x27;sys&#x27;,&#x27;plan&#x27;]})) {
          const userService &#x3D; await this.servicesRepository.findOne({where:{radiusId:o.id},relations:[&#x27;sys&#x27;,&#x27;plan&#x27;]})
          let found &#x3D; false
          sysOnNode.forEach(async u &#x3D;&gt;{
            if (u[&#x27;id_servicio&#x27;] &#x3D;&#x3D; userService.clientId){
              //Ubícalo en la lista de clientes del nodo
              const compServ &#x3D; u
              found &#x3D; true
              //encuentra el/los grupo/s:
              if (compServ[&#x27;estado&#x27;]&#x3D;&#x3D;&#x27;Suspendido&#x27;){
                if (await this.radUserGroupRepository.findOne({where:{username:o.username,priority:0}})){
              } else{
                await this.UpdateService(userService.id,{sys:userService.sys,status:2,clientId:userService.clientId,plan:userService.plan,radiusId:userService.radiusId})
                this.coaServices.SuspendUser(o.username)
              }
              } else if(compServ[&#x27;estado&#x27;]&#x3D;&#x3D;&#x27;Cancelado&#x27;){
                if (await this.radUserGroupRepository.findOne({where:{username:o.username,groupname:&#x27;cancelado&#x27;}})){}
                 else{
                  await this.UpdateService(userService.id,{sys:userService.sys,status:3,clientId:userService.clientId,plan:userService.plan,radiusId:userService.radiusId})
                  this.coaServices.ChangePlan({username:o.username,newgroupname:&#x27;cancelado&#x27;})
                }
                }
              else {
                //revisar si no estaba suspendido o cancelado en la tabla de servicios
                if (userService.status !&#x3D; 1 &amp;&amp; userService.status !&#x3D; 4 ){
                  await this.UpdateService(userService.id,{sys:userService.sys,status:1,clientId:userService.clientId,plan:userService.plan,radiusId:userService.radiusId})
                  this.coaServices.ActivateUser(o.username)
                }
                //encontrar listname del plan del servicio
                const plan &#x3D; await this.plansRepository.findOne({where:{name:compServ[&#x27;plan_internet&#x27;][&#x27;nombre&#x27;]}})
                if (plan){
                if (userService[&#x27;plan&#x27;][&#x27;id&#x27;] !&#x3D; plan.id){
                  await this.UpdateService(userService.id,{sys:userService.sys,clientId:userService.id,radiusId:userService.radiusId,status:userService.status,plan:{id:plan.id,name:plan.name,listName:plan.listName}})
                  this.coaServices.ChangePlan({username:o.username,newgroupname:plan.listName})
                }} else {console.log(&#x60;Plan ${compServ[&#x27;plan_internet&#x27;][&#x27;nombre&#x27;]} no encontrado en la tabla de planes&#x60;)}
              }
            }
          })
          if (!found){
            console.log(&#x60;ID ${userService.clientId} no encontrado en la lista de ${i.name}&#x60;)
          }
        } else {console.log(&#x60;No encontrado servicio con radiusId &#x3D;&#x3D; ${o.id}&#x60;)}} else {console.log(&#x60;No hay grupos asociados a username &#x3D;&#x3D; ${o.username}&#x60;)}
        })
      })
      return &#x60;Nodo ${node} sincronizado&#x60;;
    } else {return &#x60;Tabla userinfo sin address &#x3D;&#x3D; ${node}&#x60;}
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Realiza update de una entrada mediante el id.
   * Si no hay valores para realizar el update se rechaza la peticion.
   * @param id
   * @param updateServDto
   * @returns
   */
  async UpdateService(id: number, updateServDto: UpdateServiceDto) {
    const date &#x3D; new Date();
    console.log(&#x60;Actualizando el servicio con el id: ${id}.\nFecha: ${date}\n&#x60;);
    const { radiusId,clientId,status,plan,sys } &#x3D; updateServDto

    //* Verificacion de valores para modificar *//
    if (!radiusId || !clientId || !status || !plan || !sys) {
      const str &#x3D; &#x60;Los campos para acutalizar el servicio están vacios.\n Se intentó actualizar el servicio con id: ${id}.&#x60;;
      console.log(&#x60;${str}\n------------------------------------------------\n&#x60;);
    }

    //* Se incia la modificación *//
    try {
      console.log(&#x60;Realizando update del service ${id}&#x60;);
      const serviceToUpdate &#x3D; await this.servicesRepository.findOneBy({ id })

      serviceToUpdate.radiusId &#x3D; radiusId
      serviceToUpdate.clientId &#x3D; clientId
      serviceToUpdate.status &#x3D; status
      serviceToUpdate.plan &#x3D; plan
      serviceToUpdate.sys &#x3D; sys

      const serviceUpdated &#x3D; await this.servicesRepository.save(serviceToUpdate)
      //* Verificación de update *//
      if (!serviceUpdated) {
        const str &#x3D; &#x60;No se pudo realizar update al servicio con el id: ${id}.&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );
        return str;
      }

      console.log(&#x60;Servicio actualizado exitosamente.
      \n------------------------------------------------\n&#x60;);
      return serviceToUpdate;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////
  /////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Elimina una entrada en service mendiante el id.
   * @param id
   */
  async RemoveService(id: number) {
    try {
      const date &#x3D; new Date();
      console.log(&#x60;Eliminando entrada en service con el id: ${id}.\nFecha: ${date}\n&#x60;);
      const del &#x3D; await this.servicesRepository.delete(id);

      if (!del) {
        const str &#x3D; &#x60;Hubo un problema al eliminar la entrada&#x60;;
        console.log(
          &#x60;${str}\n------------------------------------------------\n&#x60;,
        );
        return str;
      }

      console.log(&#x60;Servicio eliminado exitosamente.
      \n------------------------------------------------\n&#x60;);
      return del;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'ServicesService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
