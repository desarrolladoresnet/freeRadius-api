<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>freerad-api documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top d-block d-sm-none">
            <a href="../" class="navbar-brand">freerad-api documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li class="breadcrumb-item">Injectables</li>
  <li class="breadcrumb-item" >UserInfoService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="nav-item">
            <a href="#info" 
                class="nav-link"
                class="nav-link active"
                role="tab" id="info-tab" data-bs-toggle="tab" data-link="info">Info</a>
        </li>
        <li class="nav-item">
            <a href="#source" 
                class="nav-link"
                
                role="tab" id="source-tab" data-bs-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/user-info/user-info.service.ts</code>
        </p>





            <section data-compodoc="block-index">
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#CreateUser" >CreateUser</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#DeleteByUsername" >DeleteByUsername</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#FindAllUsers" >FindAllUsers</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#FindById" >FindById</a>
                            </li>
                            <li>
                                    <span class="modifier">Async</span>
                                <a href="#UpdateUserInfo" >UpdateUserInfo</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section data-compodoc="block-constructor">
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
<code>constructor(usersRepository: <a href="../entitys/UserInfo.html" target="_self">Repository&lt;UserInfo&gt;</a>, radCheckRepository: <a href="../entitys/RadCheck.html" target="_self">Repository&lt;RadCheck&gt;</a>, radUserGroupRepository: <a href="../entitys/RadUserGroup.html" target="_self">Repository&lt;RadUserGroup&gt;</a>, radGroupReply: <a href="../entitys/RadGroupReply.html" target="_self">Repository&lt;RadGroupReply&gt;</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="13" class="link-to-prism">src/user-info/user-info.service.ts:13</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>usersRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/UserInfo.html" target="_self" >Repository&lt;UserInfo&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>radCheckRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/RadCheck.html" target="_self" >Repository&lt;RadCheck&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>radUserGroupRepository</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/RadUserGroup.html" target="_self" >Repository&lt;RadUserGroup&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>radGroupReply</td>
                                                  
                                                        <td>
                                                                        <code><a href="../entitys/RadGroupReply.html" target="_self" >Repository&lt;RadGroupReply&gt;</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section data-compodoc="block-methods">
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="CreateUser"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>CreateUser</b></span>
                        <a href="#CreateUser"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>CreateUser(data: <a href="../classes/UserDto.html" target="_self">UserDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="36"
                            class="link-to-prism">src/user-info/user-info.service.ts:36</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Enpoint principal de la app.
La info puede ser enviada varias veces, en caso de que los datos ya se encuentren en la BD,
se har´s un salto a la siguiente parte del proceso.
Esto con motivo de que si por alguna razón, fallara el proceso de guardado, se pueda reintentar inmediatamente.
Retorna el objeto creado más un campo &#39;msj&#39; con todos los mensajes del proceso.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>data</td>
                                    <td>
                                                <code><a href="../classes/UserDto.html" target="_self" >UserDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="DeleteByUsername"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>DeleteByUsername</b></span>
                        <a href="#DeleteByUsername"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>DeleteByUsername(username: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="490"
                            class="link-to-prism">src/user-info/user-info.service.ts:490</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Permite eliminar a un usuario de la tres tablas usadas para ser creado.
En sintesis es el opuesto de CreateUser.
usa el username para eliminar al usuario,, si por alguna razón la entrada no existe en alguna de las tablas no genera error y se pasa a la opercion siguiente.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>username</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >any</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="FindAllUsers"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>FindAllUsers</b></span>
                        <a href="#FindAllUsers"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>FindAllUsers()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="295"
                            class="link-to-prism">src/user-info/user-info.service.ts:295</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Devuelve un array/lista con todas las entradas encontradas.</p>
</div>

                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../entitys/UserInfo.html" target="_self" >Promise&lt;UserInfo[]&gt;</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="FindById"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>FindById</b></span>
                        <a href="#FindById"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>FindById(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="338"
                            class="link-to-prism">src/user-info/user-info.service.ts:338</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Buscan una entrada en la tbla &#39;userinfo&#39; a traves del id.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="UpdateUserInfo"></a>
                    <span class="name">
                        <span class="modifier">Async</span>
                        <span ><b>UpdateUserInfo</b></span>
                        <a href="#UpdateUserInfo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>UpdateUserInfo(id: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, data: <a href="../classes/UserUpdateDto.html" target="_self">UserUpdateDto</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="384"
                            class="link-to-prism">src/user-info/user-info.service.ts:384</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-description"><p>Permite modificar una entrada de la tabla &#39;userinfo&#39;.
Si la entrada no existe la operación es rechazada.</p>
</div>

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>id</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>data</td>
                                    <td>
                                                <code><a href="../classes/UserUpdateDto.html" target="_self" >UserUpdateDto</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>unknown</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import { HttpException, HttpStatus, Injectable } from &#x27;@nestjs/common&#x27;;
import { InjectRepository } from &#x27;@nestjs/typeorm&#x27;;
import { Not, Repository } from &#x27;typeorm&#x27;;
import { UserDto } from &#x27;src/dto/user.dto&#x27;;
import { RadCheck } from &#x27;src/database/radcheck.entity&#x27;;
import { RadUserGroup } from &#x27;src/database/radusergroup.entity&#x27;;
import { UserInfo } from &#x27;src/database/user.entity&#x27;;
import { UserUpdateDto } from &#x27;src/dto/userUpdate.dto&#x27;;
import { RadGroupReply } from &#x27;src/database/radgroupreply.entity&#x27;;

@Injectable()
export class UserInfoService {
  constructor(
    @InjectRepository(UserInfo)
    private usersRepository: Repository&lt;UserInfo&gt;,
    @InjectRepository(RadCheck)
    private radCheckRepository: Repository&lt;RadCheck&gt;,
    @InjectRepository(RadUserGroup)
    private radUserGroupRepository: Repository&lt;RadUserGroup&gt;,
    @InjectRepository(RadGroupReply)
    private radGroupReply: Repository&lt;RadGroupReply&gt;,
  ) {}

  //////////////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Enpoint principal de la app.
   * La info puede ser enviada varias veces, en caso de que los datos ya se encuentren en la BD,
   * se har´s un salto a la siguiente parte del proceso. 
   * Esto con motivo de que si por alguna razón, fallara el proceso de guardado, se pueda reintentar inmediatamente.
   * Retorna el objeto creado más un campo &#x27;msj&#x27; con todos los mensajes del proceso.
   * @param data { UserDto }
   * @returns { object }
   */
  async CreateUser(data: UserDto) {
    const date &#x3D; new Date();
    console.log(&#x60;Se inicia creación de usuario.\nFecha: ${date}\n&#x60;)
    try {
      const {
        firstname,
        lastname,
        username,
        creationby,
        groupname,
        priority,
        address,
        password,
      } &#x3D; data;

      let msj &#x3D; &#x27;&#x27;;
      /////////////////////////////////////////////////////////////////////////////
      //      USERINFO                                                          //
      /////////////////////////////////////////////////////////////////////////////

      //* Si no existe el plan se aborta toda la operación *//
      const isPlan &#x3D; await this.radGroupReply.findOneBy({ groupname });
      if(!isPlan) {
        const err &#x3D; new Error(&#x27;El plan no existe en la base de datos.&#x27;)
        throw new HttpException(
          {
            status: HttpStatus.BAD_REQUEST,
            error: &#x27;El plan no existe en la base de datos.&#x27;,
          },
          HttpStatus.BAD_REQUEST,
          {
            cause: err,
          },
        );
      };

      console.log(&#x60;Creando el usuario/onu: ${username}&#x60;);

      //* Se verifica si ya hay un username en la BD *//
      const ifUser &#x3D; await this.usersRepository.findOneBy({
        username: username,
      });


      let user;
      if (ifUser) {
        // Si exite se salta al siguiente paso.
        const str &#x3D; &#x60;El username/onu: ${username} ya esta registrada como usuario.\n&#x60;;
        msj +&#x3D; str;
        console.log(&#x60;${str}&#x60;);
        user &#x3D; ifUser;
      }
      else {
        const nowDate &#x3D; new Date();

        const newLocal &#x3D; this.usersRepository.create({
          firstname: firstname,
          lastname: lastname,
          username: username,
          creationby: creationby,
          address: address,
          /* CAMPOS OPCIONALES */
          // La idea es no dejar campos vacíos que pudioeran ser explotados por un Hacker.
          // Por otro lado, siempre se hace una lectura de todos los campos en el &#x27;dto&#x27; por si en algun momento futuro se llega a necesitar. 
          updateby: creationby, // se deja igual que creation by, lo que indica que nunca se le ha hecho update.
          email: data?.email ? data.email : &#x27;0&#x27;,
          country: &#x27;Venezuela&#x27;,
          department: data?.department ? data.department : &#x27;0&#x27;,
          company: data?.company ? data.company : &#x27;0&#x27;,
          workphone: data?.workphone ? data.workphone : &#x27;0&#x27;,
          homephone: data?.homephone ? data.homephone : &#x27;0&#x27;,
          mobilephone: data?.mobilephone ? data.mobilephone : &#x27;0&#x27;,
          city: data?.city ? data.city : &#x27;0&#x27;,
          state: data?.state ? data.state : &#x27;0&#x27;,
          zip: data?.zip ? data.zip : &#x27;0&#x27;,
          notes: data?.notes ? data.notes : &#x27;Sin notas&#x27;,
          changeuserinfo: data?.changeuserinfo ? data.changeuserinfo : &#x27;0&#x27;,
          portalloginpassword: data?.portalloginpassword
            ? data.portalloginpassword
            : &#x27;0&#x27;,
          enableportallogin: data?.enableportallogin ? data.enableportallogin : 0,
          creationdate: nowDate,
          updatedate: nowDate,

        });
        const newUser &#x3D; newLocal;
        console.log(newUser);
        user &#x3D; await this.usersRepository.save(newUser);

        //* Verifica que el usuario haya sido creado exitosamente *//
        if (!user) {
          // Si falla en este punto se corta la ejecución y se envia msj de error.
          const str &#x3D; &#x60;No se pudo crear el usuario/onu: ${username}&#x60;;
          console.log(&#x60;------------------------------------------------\n&#x60;);
  
          const err &#x3D; new Error(str);
          throw new HttpException(
            {
              status: HttpStatus.INTERNAL_SERVER_ERROR,
              error: str,
            },
            HttpStatus.INTERNAL_SERVER_ERROR,
            {
              cause: err,
            },
          );
        }
      }

      /////////////////////////////////////////////////////////////////////////////
      //       RADCHECK                                                          //
      /////////////////////////////////////////////////////////////////////////////

      console.log(&#x60;Registrando radcheck de ${username}&#x60;);

      const isRadcheck &#x3D; await this.radCheckRepository.findOneBy({username})
      //* Se verifica si existe la entrada en la tabla para ese username *//
      if (isRadcheck) {
        // Evalua si el password es igual.
        if(!(isRadcheck.value &#x3D;&#x3D;&#x3D; password)) {
          const str &#x3D; &#x60;El password difiere, se procede a actualizar.\n&#x60;;
          isRadcheck.value &#x3D; password;
          console.log(&#x60;${str}&#x60;);
          msj +&#x3D; str;
          const actualizedRadcheck &#x3D; await this.radCheckRepository.save(isRadcheck);
          // Verifica si hubo error en la actualizacion del password
          if(!actualizedRadcheck) {
            const str &#x3D; &#x60;Hubo un problema al actualizar el password de: ${username}.\n&#x60;;
            console.log(&#x60;${str}&#x60;);
            msj +&#x3D; str;
          }
        }
          // Si no hay necesidad de actualizar el password se añade este msj.
        else {
          const str &#x3D; &#x60;Ya existe una entrada radcheck para el usuario: ${username}, y con el mismo password.\n&#x60;;
          console.log(&#x60;${str}&#x60;);
          msj +&#x3D; str;
        }
      }
      //* Si el usuario no existe en la tabla, se procede a ser creado *//
      else {
        
      const radcheckCreate &#x3D; this.radCheckRepository.create({
        username: username,
        attribute: &#x27;Cleartext-Password&#x27;,
        op: &#x27;:&#x3D;&#x27;,
        value: password,
      });

      const saveRadCheck &#x3D; await this.radCheckRepository.save(radcheckCreate);
      // Se verifica que la entrada haya sido creada exitosamente.
      if (!saveRadCheck) {
        const str &#x3D; &#x60;Hubo un error al guardar los datos del usuario/onu: ${username} en la tabla &quot;radcheck&quot;\n.&#x60;;
        console.log(&#x60;${str}&#x60;);
        msj +&#x3D; str

        const err &#x3D; new Error(str);
          throw new HttpException(
            {
              status: HttpStatus.INTERNAL_SERVER_ERROR,
              error: str,
            },
            HttpStatus.INTERNAL_SERVER_ERROR,
            {
              cause: err,
            },
          );
      }
      console.log(&#x60;\nExito al registrar el RADCHECK&#x60;);
      }

      /////////////////////////////////////////////////////////////////////////////
      //       RADUSERGROUP                                                      //
      /////////////////////////////////////////////////////////////////////////////

      console.log(&#x60;Registrando usergroup de ${username}&#x60;);

      //* Se realiza la busqueda de username con usergroup *//
      const isRadduser &#x3D; await this.radUserGroupRepository.findBy({ username, groupname: Not(&quot;suspendido&quot;) });

      if( isRadduser?.length &gt; 0 ){
        // Solo debe haber una entrada, si hay mas se envia un msj de alerta.
        if (isRadduser?.length &gt; 1) {
          const alerta &#x3D; &#x60;ALERTA: Existen múltiples entradas para el username: ${username}, donde el ‘groupname‘ no es ‘suspendido’. Posiblemente suscrito a más de un plan \nPOR FAVOR ALERTAR A INGIENERIA.\n&#x60;;
          console.log(alerta);
          msj +&#x3D; alerta;
        }// Se verifica que los planes coincidan.
        else if (!(isRadduser[0].groupname &#x3D;&#x3D;&#x3D; groupname)) {
          const str &#x3D; &#x60;Ya existe una entrada en &#x27;radusergroup&#x27; pero los planes no coinciden, se procede a actualizar&#x60;;
          console.log(str);
          msj +&#x3D; str
          isRadduser[0].groupname &#x3D; groupname;
          const userGrooupActulized &#x3D; await this.radUserGroupRepository.save(isRadduser);
          // Verifica la actualización.
          if (!userGrooupActulized) {
            const str &#x3D; &#x60;Actualizacion de &#x27;radusergroup&#x27; para username:${username} fallida.\n&#x60;;
            msj +&#x3D; str
            console.log(str);
          }
          else {
            const str &#x3D; &#x60;Actualizacion de &#x27;radusergroup&#x27; para username:${username} exitosa.\n&#x60;;
            msj +&#x3D; str
            console.log(str);
          }
        }// Si lo planes coinciden no se realiza ninguna operación.
        else {
          const str &#x3D; &#x60;Ya existía una entrada en &#x27;radusergroup&#x27; para username:${username}. Los planes coinciden.\n&#x60;;
          msj +&#x3D; str
          console.log(str);
        }
      }//* Si no existe la entrada en la tabla. *//
      else {
        const usergroup &#x3D; await this.radUserGroupRepository.create({
          username: username,
          groupname: groupname,
          priority: priority ? priority : 10,
        });
  
        const saveUserGroup &#x3D; await this.radUserGroupRepository.save(usergroup);
  
        //* Verifica que la entrada se haya guardado exitosamente *//
        if (!saveUserGroup) {
          const str &#x3D; &#x60;Hubo un error al guardar los datos del usuario/onu ${username} en la tabla &quot;radusergroup&quot;.&#x60;;
          console.log(&#x60;------------------------------------------------\n&#x60;);
  
          const err &#x3D; new Error(str);
          throw new HttpException(
            {
              status: HttpStatus.INTERNAL_SERVER_ERROR,
              error: str,
            },
            HttpStatus.INTERNAL_SERVER_ERROR,
            {
              cause: err,
            },
          );
        }
      }

      console.log(&#x60;Usuario/onu ${username} registrado exitosamente&#x60;);
      console.log(&#x60;------------------------------------------------\n&#x60;);

      user.message &#x3D; msj;
      return user;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Devuelve un array/lista con todas las entradas encontradas.
   * @returns { Array }
   */
  async FindAllUsers(): Promise&lt;UserInfo[]&gt; {
    const date &#x3D; new Date();
    console.log(&#x60;Se inicia busqueda de usuarios.\nFecha: ${date}\n&#x60;)
    try {
      const users &#x3D; await this.usersRepository.find();

      if (users?.length &lt; 1) {
        const str &#x3D; &#x27;No se encontraron usuarios/onu&#x27;;
        console.log(&#x60;------------------------------------------------\n&#x60;);

        const err &#x3D; new Error(str);
        throw new HttpException(
          {
            status: HttpStatus.NOT_FOUND,
            error: str,
          },
          HttpStatus.NOT_FOUND,
          {
            cause: err,
          },
        );
      }

      console.log(
        &#x60;Se encontraron ${users.length} usuarios/onus \n------------------------------------------------\n&#x60;,
      );
      return users;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Buscan una entrada en la tbla &#x27;userinfo&#x27; a traves del id.
   * @param id { number }
   * @returns { UserInfo }
   */
  async FindById(id: number) {
    try {
      const date &#x3D; new Date();
      console.log(&#x60;\nFecha: ${date}\n&#x60;)
      console.log(&#x60;Bucando usuario/onu con id: ${id}&#x60;);
      const users &#x3D; await this.usersRepository.findOneBy({ id: id });

      if (!users) {
        const str &#x3D; &#x60;No se econtro usuario/onu con id: ${id}&#x60;;
        console.log(&#x60;------------------------------------------------\n&#x60;);

        const err &#x3D; new Error(str);
        throw new HttpException(
          {
            status: HttpStatus.NOT_FOUND,
            error: str,
          },
          HttpStatus.NOT_FOUND,
          {
            cause: err,
          },
        );
      }

      console.log(
        &#x60;Usuario/onu encontrado!\n------------------------------------------------\n&#x60;,
      );
      return users;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Permite modificar una entrada de la tabla &#x27;userinfo&#x27;.
   * Si la entrada no existe la operación es rechazada.
   * @param id { number }
   * @param data { UserUpdateDto }
   * @returns { UserInfo }
   */
  async UpdateUserInfo(id: number, data: UserUpdateDto) {
    const date &#x3D; new Date();
    console.log(&#x60;Se inicia actualización de usuario de usuario.\nFecha: ${date}\n&#x60;);

    let flag &#x3D; false;
    for (const obj in data) {
      if (obj) {
        console.log(obj)
        flag &#x3D; true;
        break;
      }
    }

    if(!flag){
      const str &#x3D; &#x60;No hay datos a modificar.&#x60;;
      console.log(&#x60;${str}\n------------------------------------------------\n&#x60;);
      return str;
    }

    try {
      console.log(&#x60;Actualizando al usuario: ${data.username}&#x60;);

      const User &#x3D; await this.usersRepository.findOneBy({ id });

      if (!User) {
        const str &#x3D; &#x60;El username/onu: ${data.username} no está asignada o no existe.&#x60;;
        console.log(&#x60;------------------------------------------------\n&#x60;);

        const err &#x3D; new Error(str);
        throw new HttpException(
          {
            status: HttpStatus.NOT_FOUND,
            error: str,
          },
          HttpStatus.NOT_FOUND,
          {
            cause: err,
          },
        );
      }

      // Se evalúa si uno o más campos serán modificados.
      User.firstname &#x3D; data?.firstname ? data.firstname : User.firstname;
      User.lastname &#x3D; data?.lastname ? data.lastname : User.lastname;
      User.username &#x3D; data?.username ? data.username : User.lastname;
      User.email &#x3D; data?.email ? data.email : User.email;
      User.department &#x3D; data?.department ? data.department : User.department;
      User.company &#x3D; data?.company ? data.company : User.company;
      User.workphone &#x3D; data?.workphone ? data.workphone : User.workphone;
      User.homephone &#x3D; data?.homephone ? data.homephone : User.homephone;
      User.mobilephone &#x3D; data?.mobilephone
        ? data.mobilephone
        : User.mobilephone;
      User.address &#x3D; data?.address ? data.address : User.address;
      User.city &#x3D; data?.city ? data.city : User.city;
      User.state &#x3D; data?.state ? data.state : User.state;
      User.zip &#x3D; data?.zip ? data.zip : User.zip;
      User.notes &#x3D; data?.notes ? data.notes : User.notes;
      User.changeuserinfo &#x3D; data?.changeuserinfo
        ? data.changeuserinfo
        : User.changeuserinfo;
      User.portalloginpassword &#x3D; data?.portalloginpassword
        ? data.portalloginpassword
        : User.portalloginpassword;
      User.enableportallogin &#x3D; data?.enableportallogin
        ? data.enableportallogin
        : User.enableportallogin;
      User.updateby &#x3D; data.updateby;

      const updateUser &#x3D; await this.usersRepository.save(User);

      if (!updateUser) {
        const str &#x3D; &#x60;No se pudo actualizar la username/onu : ${data.username}&#x60;;
        console.log(&#x60;------------------------------------------------\n&#x60;);

        const err &#x3D; new Error(str);
        throw new HttpException(
          {
            status: HttpStatus.INTERNAL_SERVER_ERROR,
            error: str,
          },
          HttpStatus.INTERNAL_SERVER_ERROR,
          {
            cause: err,
          },
        );
      }

      return updateUser;
    } catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }

  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////
  //////////////////////////////////////////////////////////////////////////////////////////////////////////

  /**
   * Permite eliminar a un usuario de la tres tablas usadas para ser creado.
   * En sintesis es el opuesto de CreateUser.
   * usa el username para eliminar al usuario,, si por alguna razón la entrada no existe en alguna de las tablas no genera error y se pasa a la opercion siguiente.
   * @param username { string }
   */
  async DeleteByUsername(username: string) {
    const date &#x3D; new Date();
    console.log(&#x60;Se inicia eliminacion de usuario ${username} de la BD.\nFecha: ${date}\n&#x60;);
    try{
      //const user &#x3D; await this.usersRepository.findBy({ username });
      await this.usersRepository.delete({ username });
      await this.radUserGroupRepository.delete({ username });
      await this.radCheckRepository.delete({ username });

      console.log(&#x27;Borrado exitoso&#x27;);
      console.log(&#x60;------------------------------------------------\n&#x60;);
    }
    catch (error) {
      console.error(error);
      console.log(&#x60;------------------------------------------------\n&#x60;);
      throw new HttpException(error, HttpStatus.INTERNAL_SERVER_ERROR);
    }
  }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'UserInfoService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
